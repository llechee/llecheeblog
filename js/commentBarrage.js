function startbarrage(){try{clearInterval(timer),document.querySelector(".comment-barrage").innerHTML="",delete sw}catch(t){}const t={lightColors:[["#ffffffaa!important","var(--lyx-black)"]],darkColors:[["#000a!important","var(--lyx-white)"]],maxBarrage:1,barrageTime:3e3,twikooUrl:"https://tkapi.yisous.xyz",accessToken:"1059857c25a2ce9fba9cff298f4f33ee",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,noAvatarType:"retro",dom:document.querySelector(".comment-barrage"),displayBarrage:!0,avatarCDN:"cravatar.cn"};function e(t){var e=t;return 1==new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/).test(e)}function a(t){const e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return t.offsetTop-document.documentElement.scrollTop<=e}function r(t){if(t.replies){let e=[t];return t.replies.forEach((t=>{e.push(...r(t))})),e}return[]}function n(a){let r=document.createElement("div");t.dom.clientWidth,t.dom.clientHeight;r.className="comment-barrage-item";let n=Math.floor(Math.random()*t.lightColors.length);document.getElementById("barragesColor").innerHTML=`[data-theme='light'] .comment-barrage-item { background-color:${t.lightColors[n][0]};color:${t.lightColors[n][1]}}[data-theme='dark'] .comment-barrage-item{ background-color:${t.darkColors[n][0]};color:${t.darkColors[n][1]}}`,null!=a.avatar?null!=a.link?(e(a.link)||(a.link="http://"+a.link),r.innerHTML=`\n\t\t\t<div class="barrageHead">\n\t\t\t\t<img class="barrageAvatar" src="${a.avatar}"/>\n\t\t\t\t<a href="${a.link}" class="barrageNick" target="_blank">${a.nick}</a>\n\t\t\t\t<a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n\t\t\t</div>\n\t\t\t`):r.innerHTML=`\n\t\t\t<div class="barrageHead">\n\t\t\t\t<img class="barrageAvatar" src="${a.avatar}"/>\n\t\t\t\t<div class="barrageNick">${a.nick}</div>\n\t\t\t\t<a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n\t\t\t</div>\n\t\t\t`:null!=a.link?(e(a.link)||(a.link="http://"+a.link),r.innerHTML=`\n\t\t\t<div class="barrageHead">\n\t\t\t\t<img class="barrageAvatar" src="https://${t.avatarCDN}/avatar/${a.mailMd5}?d=${t.noAvatarType}"/>\n\t\t\t\t<a href="${a.link}" class="barrageNick" target="_blank">${a.nick}</a>\n\t\t\t\t<a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n\t\t\t</div>\n\t\t\t`):r.innerHTML=`\n\t\t\t<div class="barrageHead">\n\t\t\t\t<img class="barrageAvatar" src="https://${t.avatarCDN}/avatar/${a.mailMd5}?d=${t.noAvatarType}"/>\n\t\t\t\t<div class="barrageNick">${a.nick}</div>\n\t\t\t\t<a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n\t\t\t</div>\n\t\t\t`,barrageContent=document.createElement("a"),barrageContent.className="barrageContent",barrageContent.href="#"+a.id,barrageContent.innerHTML=a.comment,r.appendChild(barrageContent),aswiper=document.createElement("div"),aswiper.className="swiper-slide",aswiper.setAttribute("style","height: 150px;"),aswiper.append(r),t.dom.append(aswiper)}var o,s;-1==location.href.indexOf("posts")&&-1==location.href.indexOf("posts")||(document.onscroll=function(){t.displayBarrage&&(a(document.getElementById("post-comment"))?(document.getElementsByClassName("barrageswiper")[0].style.transform="translateX(514px)",document.getElementsByClassName("barrageswiper")[0].style.opacity="0"):(document.getElementsByClassName("barrageswiper")[0].style.transform="",document.getElementsByClassName("barrageswiper")[0].style.opacity="1"))}),switchCommentBarrage=function(){if(localStorage.setItem("isBarrageToggle",Number(!Number(localStorage.getItem("isBarrageToggle")))),!a(document.getElementById("post-comment"))){t.displayBarrage=!t.displayBarrage;let e=document.querySelector(".comment-barrage");e&&$(e).fadeToggle()}},null==localStorage.getItem("isBarrageToggle")?localStorage.setItem("isBarrageToggle","0"):"1"==localStorage.getItem("isBarrageToggle")&&(localStorage.setItem("isBarrageToggle","0"),switchCommentBarrage()),o=JSON.stringify({event:"COMMENT_GET","commentBarrageConfig.accessToken":t.accessToken,url:t.pageUrl}),(s=new XMLHttpRequest).withCredentials=!0,s.addEventListener("readystatechange",(function(){if(4===this.readyState){for(t.barrageList=function(t){t.sort(((t,e)=>t.created-e.created));let e=[];return t.forEach((t=>{e.push(...r(t))})),e}(JSON.parse(this.responseText).data),t.dom.innerHTML="",t.barrageIndex=0;t.barrageIndex<t.barrageList.length;t.barrageIndex++)n(t.barrageList[t.barrageIndex]);kkksc03=new Swiper(".barrageswiper",{direction:"vertical",loop:!0,mousewheel:!0,autoplay:{delay:3e3,stopOnLastSlide:!1,disableOnInteraction:!1}}),kkksc03.el.onmouseover=function(){kkksc03.autoplay.stop()},kkksc03.el.onmouseout=function(){kkksc03.autoplay.start()}}})),s.open("POST",t.twikooUrl),s.setRequestHeader("Content-Type","application/json"),s.send(o)}document.addEventListener("pjax:complete",startbarrage),document.addEventListener("DOMContentLoaded",startbarrage);